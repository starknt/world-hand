var egret;(p=>{class _{}_.LITTLE_ENDIAN="littleEndian",_.BIG_ENDIAN="bigEndian",p.Endian=_;let f;(i=>(i[i.LITTLE_ENDIAN=0]="LITTLE_ENDIAN",i[i.BIG_ENDIAN=1]="BIG_ENDIAN"))(f=p.EndianConst||(p.EndianConst={}));let d;(o=>(o[o.SIZE_OF_BOOLEAN=1]="SIZE_OF_BOOLEAN",o[o.SIZE_OF_INT8=1]="SIZE_OF_INT8",o[o.SIZE_OF_INT16=2]="SIZE_OF_INT16",o[o.SIZE_OF_INT32=4]="SIZE_OF_INT32",o[o.SIZE_OF_UINT8=1]="SIZE_OF_UINT8",o[o.SIZE_OF_UINT16=2]="SIZE_OF_UINT16",o[o.SIZE_OF_UINT32=4]="SIZE_OF_UINT32",o[o.SIZE_OF_FLOAT32=4]="SIZE_OF_FLOAT32",o[o.SIZE_OF_FLOAT64=8]="SIZE_OF_FLOAT64"))(d||(d={}));class E{constructor(t,i=0){this.bufferExtSize=0;this.EOF_byte=-1;this.EOF_code_point=-1;i<0&&(i=0),this.bufferExtSize=i;let e,r=0;if(t){let n;if(t instanceof Uint8Array?(n=t,r=t.length):(r=t.byteLength,n=new Uint8Array(t)),i==0)e=new Uint8Array(r);else{let s=(r/i|0)+1;e=new Uint8Array(s*i)}e.set(n)}else e=new Uint8Array(i);this.write_position=r,this._position=0,this._bytes=e,this.data=new DataView(e.buffer),this.endian=_.BIG_ENDIAN}get endian(){return this.$endian==0?_.LITTLE_ENDIAN:_.BIG_ENDIAN}set endian(t){this.$endian=t==_.LITTLE_ENDIAN?0:1}setArrayBuffer(t){}get readAvailable(){return this.write_position-this._position}get buffer(){return this.data.buffer.slice(0,this.write_position)}get rawBuffer(){return this.data.buffer}set buffer(t){let i=t.byteLength,e=new Uint8Array(t),r=this.bufferExtSize,n;if(r==0)n=new Uint8Array(i);else{let s=(i/r|0)+1;n=new Uint8Array(s*r)}n.set(e),this.write_position=i,this._bytes=n,this.data=new DataView(n.buffer)}get bytes(){return this._bytes}get dataView(){return this.data}set dataView(t){this.buffer=t.buffer}get bufferOffset(){return this.data.byteOffset}get position(){return this._position}set position(t){this._position=t,t>this.write_position&&(this.write_position=t)}get length(){return this.write_position}set length(t){this.write_position=t,this.data.byteLength>t&&(this._position=t),this._validateBuffer(t)}_validateBuffer(t){if(this.data.byteLength<t){let i=this.bufferExtSize,e;if(i==0)e=new Uint8Array(t);else{let r=((t/i>>0)+1)*i;e=new Uint8Array(r)}e.set(this._bytes),this._bytes=e,this.data=new DataView(e.buffer)}}get bytesAvailable(){return this.data.byteLength-this._position}clear(){let t=new ArrayBuffer(this.bufferExtSize);this.data=new DataView(t),this._bytes=new Uint8Array(t),this._position=0,this.write_position=0}readBoolean(){if(this.validate(1))return!!this._bytes[this.position++]}readByte(){if(this.validate(1))return this.data.getInt8(this.position++)}readBytes(t,i=0,e=0){if(!t)return;let r=this._position,n=this.write_position-r;if(n<0){console.error("end of the file");return}if(e==0)e=n;else if(e>n){console.error("end of the file");return}let s=t._position;t._position=0,t.validateBuffer(i+e),t._position=s,t._bytes.set(this._bytes.subarray(r,r+e),i),this.position+=e}readDouble(){if(this.validate(8)){let t=this.data.getFloat64(this._position,this.$endian==0);return this.position+=8,t}}readFloat(){if(this.validate(4)){let t=this.data.getFloat32(this._position,this.$endian==0);return this.position+=4,t}}readInt(){if(this.validate(4)){let t=this.data.getInt32(this._position,this.$endian==0);return this.position+=4,t}}readShort(){if(this.validate(2)){let t=this.data.getInt16(this._position,this.$endian==0);return this.position+=2,t}}readUnsignedByte(){if(this.validate(1))return this._bytes[this.position++]}readUnsignedInt(){if(this.validate(4)){let t=this.data.getUint32(this._position,this.$endian==0);return this.position+=4,t}}readUnsignedShort(){if(this.validate(2)){let t=this.data.getUint16(this._position,this.$endian==0);return this.position+=2,t}}readUTF(){let t=this.readUnsignedShort();return t>0?this.readUTFBytes(t):""}readUTFBytes(t){if(!this.validate(t))return;let i=this.data,e=new Uint8Array(i.buffer,i.byteOffset+this._position,t);return this.position+=t,this.decodeUTF8(e)}writeBoolean(t){this.validateBuffer(1),this._bytes[this.position++]=+t}writeByte(t){this.validateBuffer(1),this._bytes[this.position++]=t&255}writeBytes(t,i=0,e=0){let r;i<0||e<0||(e==0?r=t.length-i:r=Math.min(t.length-i,e),r>0&&(this.validateBuffer(r),this._bytes.set(t._bytes.subarray(i,i+r),this._position),this.position=this._position+r))}writeDouble(t){this.validateBuffer(8),this.data.setFloat64(this._position,t,this.$endian==0),this.position+=8}writeFloat(t){this.validateBuffer(4),this.data.setFloat32(this._position,t,this.$endian==0),this.position+=4}writeInt(t){this.validateBuffer(4),this.data.setInt32(this._position,t,this.$endian==0),this.position+=4}writeShort(t){this.validateBuffer(2),this.data.setInt16(this._position,t,this.$endian==0),this.position+=2}writeUnsignedInt(t){this.validateBuffer(4),this.data.setUint32(this._position,t,this.$endian==0),this.position+=4}writeUnsignedShort(t){this.validateBuffer(2),this.data.setUint16(this._position,t,this.$endian==0),this.position+=2}writeUTF(t){let i=this.encodeUTF8(t),e=i.length;this.validateBuffer(2+e),this.data.setUint16(this._position,e,this.$endian==0),this.position+=2,this._writeUint8Array(i,!1)}writeUTFBytes(t){this._writeUint8Array(this.encodeUTF8(t))}toString(){return"[ByteArray] length:"+this.length+", bytesAvailable:"+this.bytesAvailable}_writeUint8Array(t,i=!0){let e=this._position,r=e+t.length;i&&this.validateBuffer(r),this.bytes.set(t,e),this.position=r}validate(t){let i=this._bytes.length;if(i>0&&this._position+t<=i)return!0;console.error("end of the file")}validateBuffer(t){this.write_position=t>this.write_position?t:this.write_position,t+=this._position,this._validateBuffer(t)}encodeUTF8(t){let i=0,e=this.stringToCodePoints(t),r=[];for(;e.length>i;){let n=e[i++];if(this.inRange(n,55296,57343))this.encoderError(n);else if(this.inRange(n,0,127))r.push(n);else{let s,a;for(this.inRange(n,128,2047)?(s=1,a=192):this.inRange(n,2048,65535)?(s=2,a=224):this.inRange(n,65536,1114111)&&(s=3,a=240),r.push(this.div(n,Math.pow(64,s))+a);s>0;){let l=this.div(n,Math.pow(64,s-1));r.push(128+l%64),s-=1}}}return new Uint8Array(r)}decodeUTF8(t){let i=!1,e=0,r="",n,s=0,a=0,l=0,o=0;for(;t.length>e;){let h=t[e++];if(h==this.EOF_byte)a!=0?n=this.decoderError(i):n=this.EOF_code_point;else if(a==0)this.inRange(h,0,127)?n=h:(this.inRange(h,194,223)?(a=1,o=128,s=h-192):this.inRange(h,224,239)?(a=2,o=2048,s=h-224):this.inRange(h,240,244)?(a=3,o=65536,s=h-240):this.decoderError(i),s=s*Math.pow(64,a),n=null);else if(!this.inRange(h,128,191))s=0,a=0,l=0,o=0,e--,n=this.decoderError(i,h);else if(l+=1,s=s+(h-128)*Math.pow(64,a-l),l!==a)n=null;else{let u=s,I=o;s=0,a=0,l=0,o=0,this.inRange(u,I,1114111)&&!this.inRange(u,55296,57343)?n=u:n=this.decoderError(i,h)}n!==null&&n!==this.EOF_code_point&&(n<=65535?n>0&&(r+=String.fromCharCode(n)):(n-=65536,r+=String.fromCharCode(55296+(n>>10&1023)),r+=String.fromCharCode(56320+(n&1023))))}return r}encoderError(t){console.error("! EncodingError The code point {0} could not be encoded.",t)}decoderError(t,i){return t&&console.log("DecodingError"),i||65533}inRange(t,i,e){return i<=t&&t<=e}div(t,i){return Math.floor(t/i)}stringToCodePoints(t){let i=[],e=0,r=t.length;for(;e<t.length;){let n=t.charCodeAt(e);if(!this.inRange(n,55296,57343))i.push(n);else if(this.inRange(n,56320,57343))i.push(65533);else if(e==r-1)i.push(65533);else{let s=t.charCodeAt(e+1);if(this.inRange(s,56320,57343)){let a=n&1023,l=s&1023;e+=1,i.push(65536+(a<<10)+l)}else i.push(65533)}e+=1}return i}}p.ByteArray=E})(egret||(egret={}));
